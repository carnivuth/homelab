- name: Update all packages to their latest version
  become: true
  ansible.builtin.apt:
    upgrade: true
    update_cache: true

- name: Install some default packages
  become: true
  ansible.builtin.apt:
    pkg:
      - vim
      - sudo
    state: present

- name: Copy motd file
  become: true
  ansible.builtin.copy:
    src: '{{ ansible_hostname }}-motd'
    dest: /etc/motd
    mode: '644'
  ignore_errors: true

- name: Run create admin task
  ansible.builtin.include_tasks:
    file: create_admin_user.yaml

- name: Copy default vim configuration
  become: true
  ansible.builtin.copy:
    src: .vimrc
    dest: '{{ item }}/.vimrc'
    mode: '600'
  with_items:
    - /root
    - '{{ admin_home }}'

- name: Copy default bash aliases
  become: true
  ansible.builtin.copy:
    src: .bash_aliases
    dest: '{{ item }}/.bash_aliases'
    mode: '700'
  with_items:
    - /root
    - '{{ admin_home }}'

- name: Include bash aliases in bashrc
  become: true
  ansible.builtin.lineinfile:
    path: '{{ item }}/.bashrc'
    regexp: ^source ~/.bash_aliases
    line: source ~/.bash_aliases
    state: present
  with_items:
    - /root
    - '{{ admin_home }}'
